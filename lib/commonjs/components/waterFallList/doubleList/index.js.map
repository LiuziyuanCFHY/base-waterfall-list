{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_config","_bizComponent","_feedRecommendCard","_utils","_style","_constants","_feedCommonGoodsCard","_FeedWeeklyPromotionCard","_interopRequireDefault","_hooks","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","keyExtractor","item","index","DoubleList","exports","memo","props","uiMode","recoList","onItemShow","onItemHide","onItemClick","data","initialNumToRender","paddingHorizontal","DEFAULT_PADDING","cardWidth","GOOD_CARD_WIDTH","refreshCount","ListFooterComponent","onEndReached","onFeedWeeklyItemShow","onFeedWeeklyPress","listKeys","left","leftKey","right","rightKey","onEndReachedThreshold","loadingStatus","leftData","lFeeds","rightData","rFeeds","updateHeight","useDoubleListData","onLayout","useCallback","listKey","event","_event$nativeEvent","nativeEvent","layout","height","renderFeedItem","feedItemIndex","type","FEED_CARD_TYPE","COMMON_GOOD_CARD","createElement","FeedCommonGoodsCard","curItem","WEEKLY_CARD","realIndex","FeedRecommendItem","windowSize","useMemo","isAndroid","undefined","renderSeparator","View","style","styles","distance","isFetching","useRef","handleEndReached","current","endReached","renderList","feeds","CommonList","renderItem","ItemSeparatorComponent","width","containerRow","justifyContent"],"sources":["index.tsx"],"sourcesContent":["import React, { memo, useCallback, useMemo, useRef } from 'react';\nimport { View } from 'react-native';\nimport {\n    DEFAULT_PADDING,\n    GOOD_CARD_WIDTH,\n    leftKey,\n    rightKey,\n} from '../config/config';\nimport { CommonList } from '@locallife/biz-component';\nimport { FeedRecommendItem } from '../feedRecommendCard';\nimport { isAndroid } from '@locallife/utils';\nimport { styles } from './style';\nimport { FEED_CARD_TYPE } from '../../../constants';\nimport { FeedCommonGoodsCard } from '../feedCommonGoodsCard';\nimport FeedWeeklyPromotionCard from '../FeedWeeklyPromotionCard';\nimport { useDoubleListData } from '../hook/hooks';\nimport { FeedModel } from '../model';\nimport { WeeklyPromotionModel } from '../FeedWeeklyPromotionCard/Model/WeeklyPromotionModel';\n\ninterface IProps {\n    uiMode?: 'space-evenly' | 'space-between';\n    recoList: Array<FeedModel>;\n    itemVisiblePercentThreshold?: number;\n    onItemShow?: (item: FeedModel, index: number) => void;\n    onItemHide?: (item: FeedModel, index: number) => void;\n    onItemClick?: (item: any, index: number) => void;\n    updateHeight?: (listKey: any, height: number) => void;\n    data?: Array<FeedModel>;\n    index: number;\n    initialNumToRender?: number;\n    paddingHorizontal?: number;\n    cardWidth?: number;\n    refreshCount?: number;\n    listKeys?: {\n        left: string;\n        right: string;\n    };\n    ListFooterComponent?: () => React.ReactElement | null;\n    onFeedWeeklyItemShow?: (\n        item: WeeklyPromotionModel,\n        feedItemIndex: number,\n        index: number,\n    ) => void;\n    onFeedWeeklyPress?: (\n        item: WeeklyPromotionModel,\n        feedItemIndex: number,\n        index: number,\n    ) => void;\n    onEndReached?: () => void;\n    onEndReachedThreshold?: number;\n    loadingStatus?: boolean;\n}\n\n// 卡片索引\nconst keyExtractor = (item: FeedModel, index: number) => {\n    return index + '_doubleList';\n};\n\nexport const DoubleList = memo((props: IProps) => {\n    const {\n        uiMode = 'space-between',\n        recoList,\n        onItemShow,\n        onItemHide,\n        onItemClick,\n        data,\n        initialNumToRender,\n        paddingHorizontal = DEFAULT_PADDING, // 左右间距，默认11\n        cardWidth = GOOD_CARD_WIDTH, // 卡片宽度，默认192\n        refreshCount,\n        ListFooterComponent,\n        onEndReached,\n        onFeedWeeklyItemShow,\n        onFeedWeeklyPress,\n        listKeys = {\n            left: leftKey,\n            right: rightKey,\n        },\n        onEndReachedThreshold,\n        loadingStatus,\n    } = props;\n\n    const {\n        leftData: lFeeds,\n        rightData: rFeeds,\n        updateHeight,\n    } = useDoubleListData(recoList, refreshCount, cardWidth);\n\n    const onLayout = useCallback(\n        (listKey, event) => {\n            updateHeight?.(listKey, event?.nativeEvent?.layout?.height);\n        },\n        [updateHeight],\n    );\n\n    // 单个卡片\n    const renderFeedItem = useCallback(\n        ({ item, index: feedItemIndex }) => {\n            if (item?.type === FEED_CARD_TYPE.COMMON_GOOD_CARD) {\n                return (\n                    <FeedCommonGoodsCard\n                        curItem={item}\n                        index={feedItemIndex}\n                        onItemClick={onItemClick}\n                        cardWidth={cardWidth}\n                    />\n                );\n            } else if (item?.type === FEED_CARD_TYPE.WEEKLY_CARD) {\n                return (\n                    <FeedWeeklyPromotionCard\n                        data={item?.data}\n                        feedItemIndex={item.realIndex}\n                        onFeedWeeklyItemShow={onFeedWeeklyItemShow}\n                        onFeedWeeklyPress={onFeedWeeklyPress}\n                    />\n                );\n            } else {\n                return (\n                    <FeedRecommendItem curItem={item} index={feedItemIndex} />\n                );\n            }\n        },\n        [cardWidth, onItemClick, onFeedWeeklyItemShow, onFeedWeeklyPress],\n    );\n\n    const windowSize = useMemo(() => {\n        return isAndroid() ? 3 : undefined;\n    }, []);\n\n    const renderSeparator = useCallback(() => {\n        return <View style={styles.distance} />;\n    }, []);\n\n    const isFetching = useRef(false);\n\n    const handleEndReached = useCallback(async () => {\n        if (isFetching.current || loadingStatus) {\n            return;\n        }\n        isFetching.current = true;\n        await onEndReached?.();\n        isFetching.current = false;\n    }, [onEndReached, loadingStatus]);\n\n    const endReached = useCallback(() => {\n        handleEndReached();\n    }, [handleEndReached]);\n\n    const renderList = useCallback(\n        (listKey: string, feeds: FeedModel[]) => {\n            return (\n                <View>\n                    <CommonList\n                        //eslint-disable-next-line react/jsx-no-bind\n                        onLayout={(event) => {\n                            onLayout(listKey, event);\n                        }}\n                        keyExtractor={keyExtractor}\n                        renderItem={renderFeedItem}\n                        data={feeds}\n                        listKey={listKey}\n                        onItemShow={onItemShow}\n                        onItemHide={onItemHide}\n                        windowSize={windowSize} // 解决安卓滑动突然转向，卡顿问题\n                        ItemSeparatorComponent={renderSeparator}\n                        initialNumToRender={initialNumToRender}\n                        style={{ width: cardWidth }}\n                        onEndReached={endReached}\n                        onEndReachedThreshold={onEndReachedThreshold ?? 0.1}\n                    />\n                </View>\n            );\n        },\n        [\n            cardWidth,\n            initialNumToRender,\n            onItemHide,\n            onItemShow,\n            onLayout,\n            renderFeedItem,\n            renderSeparator,\n            windowSize,\n            endReached,\n            onEndReachedThreshold,\n        ],\n    );\n\n    // 瀑布流卡片\n    if (lFeeds && rFeeds) {\n        return (\n            <View>\n                <View\n                    style={[\n                        styles.containerRow,\n                        {\n                            justifyContent: uiMode,\n                            paddingHorizontal: paddingHorizontal,\n                        },\n                    ]}\n                >\n                    {renderList(listKeys.left, lFeeds)}\n                    {renderList(listKeys.right, rFeeds)}\n                </View>\n                {!!ListFooterComponent && ListFooterComponent?.()}\n            </View>\n        );\n    }\n    return renderList('one', data ?? []);\n});\n"],"mappings":"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","ignoreList":[]}