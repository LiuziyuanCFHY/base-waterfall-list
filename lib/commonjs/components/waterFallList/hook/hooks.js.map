{"version":3,"names":["_react","require","_utils","_config","_baseHooks","_EStyleUtil","useDoubleListData","feedGoodsInfos","refreshCount","cardWidth","GOOD_CARD_WIDTH","leftHeight","useRef","rightHeight","dataList","setDataList","useState","leftData","setLeft","rightData","setRight","lastIndex","lastRefreshCount","useEffect","length","itemId","lData","rData","tmpFeedGoodsInfos","current","slice","forEach","item","index","newItem","realIndex","itemHeight","countFeedItemHeight","ONE_LINE_TITLE_FONT","push","prevLeftData","concat","prevRightData","updateHeight","useCallback","listKey","height","leftKey","rightKey","exports","useTextLineHook","title","lastTitle","useLatest","haveLayout","titleInfo","setTitleInfo","realTitle","lineNumber","firstLine","nextLine","maxHeight","EStyleUtil","transNumberToRem","onTextLayout","e","nativeEvent","lines","text","remainText","i"],"sources":["hooks.ts"],"sourcesContent":["/**\n * @file hooks.ts\n * @description 请在此添加属于该页面的自定义hooks\n */\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { countFeedItemHeight } from '../../../utils/utils';\nimport {\n    GOOD_CARD_WIDTH,\n    leftKey,\n    ONE_LINE_TITLE_FONT,\n    rightKey,\n} from '../config/config';\nimport { useLatest } from '@locallife/base-hooks';\nimport { FeedModel } from '../model';\nimport { EStyleUtil } from '../../../utils/EStyleUtil';\n\nexport const useDoubleListData = (\n    feedGoodsInfos: FeedModel[],\n    refreshCount: number = 0,\n    cardWidth: number = GOOD_CARD_WIDTH,\n) => {\n    const leftHeight = useRef(0);\n    const rightHeight = useRef(0);\n    const [dataList, setDataList] = useState([]);\n    const [leftData, setLeft] = useState<FeedModel[]>([]);\n    const [rightData, setRight] = useState<FeedModel[]>([]);\n    const lastIndex = useRef(0);\n    const lastRefreshCount = useRef(0);\n\n    useEffect(() => {\n        if (feedGoodsInfos.length > 0) {\n            setDataList([{ itemId: 'have-data' }]);\n        }\n    }, [feedGoodsInfos.length]);\n\n    useEffect(() => {\n        const lData = [];\n        const rData = [];\n        let tmpFeedGoodsInfos = feedGoodsInfos;\n        if (\n            lastIndex.current >= feedGoodsInfos.length &&\n            refreshCount === lastRefreshCount.current\n        ) {\n            // 没有新增卡片直接返回\n            return;\n        }\n        if (lastIndex.current !== 0) {\n            tmpFeedGoodsInfos = tmpFeedGoodsInfos.slice(lastIndex.current);\n        }\n        lastIndex.current = feedGoodsInfos.length;\n        tmpFeedGoodsInfos.forEach((item, index) => {\n            const newItem = { ...item };\n            // 1、realIndex赋值\n            newItem.realIndex = index;\n            // 2、计算卡片高度\n            const itemHeight = countFeedItemHeight(\n                newItem,\n                ONE_LINE_TITLE_FONT,\n                cardWidth,\n            );\n            // 3、构造双列的数据源\n            if (leftHeight.current <= rightHeight.current) {\n                leftHeight.current += itemHeight;\n                lData.push(newItem);\n            } else {\n                rightHeight.current += itemHeight;\n                rData.push(newItem);\n            }\n        });\n        if (refreshCount === lastRefreshCount.current) {\n            setLeft((prevLeftData) => prevLeftData.concat(lData));\n            setRight((prevRightData) => prevRightData.concat(rData));\n        } else {\n            // 重新刷新了，更新数据源\n            setLeft(lData);\n            setRight(rData);\n            lastRefreshCount.current = refreshCount;\n        }\n        // 仅feedGoodsInfos依赖即可\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [feedGoodsInfos]);\n\n    const updateHeight = useCallback((listKey: string, height: number) => {\n        if (listKey === leftKey) {\n            leftHeight.current = height;\n        } else if (listKey === rightKey) {\n            rightHeight.current = height;\n        }\n    }, []);\n\n    return {\n        dataList,\n        leftData,\n        rightData,\n        updateHeight,\n    };\n};\n\nexport const useTextLineHook = (title: string) => {\n    const lastTitle = useLatest(title);\n    const haveLayout = useRef(false);\n\n    const [titleInfo, setTitleInfo] = useState<{\n        lineNumber: number;\n        firstLine: string;\n        nextLine: string;\n        maxHeight?: number;\n        realTitle: string;\n    }>({\n        realTitle: title,\n        lineNumber: 2,\n        firstLine: lastTitle.current || '',\n        nextLine: '',\n        maxHeight: EStyleUtil.transNumberToRem(36),\n    });\n\n    useEffect(() => {\n        if (lastTitle.current !== titleInfo.realTitle) {\n            setTitleInfo({\n                realTitle: lastTitle.current,\n                lineNumber: 2,\n                firstLine: lastTitle.current || '',\n                nextLine: '',\n                maxHeight: EStyleUtil.transNumberToRem(36),\n            });\n            haveLayout.current = false;\n        }\n    }, [lastTitle, title, titleInfo.realTitle]);\n\n    const onTextLayout = useCallback(\n        (e) => {\n            if (haveLayout.current) {\n                return;\n            }\n            if (e.nativeEvent.lines.length > 1) {\n                const { text } = e.nativeEvent.lines[0];\n                let remainText = '';\n                for (let i = 1; i < e.nativeEvent.lines.length; i++) {\n                    remainText += e.nativeEvent.lines[i].text;\n                }\n                setTitleInfo({\n                    realTitle: lastTitle.current,\n                    lineNumber: 1,\n                    firstLine: text,\n                    nextLine: remainText,\n                    maxHeight: e.nativeEvent.lines[0].height * 2,\n                });\n            } else {\n                setTitleInfo({\n                    realTitle: lastTitle.current,\n                    lineNumber: 1,\n                    firstLine: lastTitle.current,\n                    nextLine: '',\n                    maxHeight: EStyleUtil.transNumberToRem(36),\n                });\n            }\n            haveLayout.current = true;\n        },\n        [lastTitle],\n    );\n    return {\n        onTextLayout,\n        titleInfo,\n    };\n};\n"],"mappings":"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","ignoreList":[]}