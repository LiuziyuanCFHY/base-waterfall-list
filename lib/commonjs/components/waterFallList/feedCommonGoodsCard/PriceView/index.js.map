{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_bizComponent","_constants","_styles","_interopRequireDefault","_utils","_utils2","_designBase","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","PriceView","exports","React","memo","goodsInfo","maxWidth","_goodsInfo$productBiz","_goodsInfo$productBiz2","_goodsInfo$productBiz3","_goodsInfo$productBiz7","_goodsInfo$productBiz8","_goodsInfo$productBiz9","isTicket","useMemo","itemTypeCode","ITEM_TYPE_CODE","TICKET","isSubCard","TIMECARD","itemTimes","productBizTagPositions","good_goods_price_right_times_card","itemPriceRightDiscount","good_goods_price_right_discount","itemPriceFormarketing","good_goods_price_right_marketing_info","hasPriceLabel","length","hasOrginPrice","originPrice","labelMaxWidth","setLabelMaxWidth","useState","showTags","setShowTags","useEffect","_goodsInfo$productBiz4","_goodsInfo$productBiz5","_goodsInfo$productBiz6","recombineBizTags","push","bizTags","_onLayout","useCallback","event","priceWidth","isIOS","rem","nativeEvent","layout","width","get414Px","remainingWidth","createElement","View","style","styles","priceInfo","priceLine","onLayout","Text","unit","priceUnit","DotDecreasePrice","price","discountPrice","firstPriceStyle","firstPrice","dotSecondPriceStyle","secondPrice","secondaryCardTimes","ShowWithData","data","originPriceText","label","CommonLabelArray","bizTagArray","adaptScreen"],"sources":["index.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { Text, View } from 'react-native';\nimport {\n    BizTagsBean,\n    CommonLabelArray,\n    DotDecreasePrice,\n    ShowWithData,\n} from '@locallife/biz-component';\nimport { FeedGoodsInfo } from '../../model';\nimport { ITEM_TYPE_CODE } from '../../../../constants';\nimport styles from './styles';\nimport { priceUnit } from '../../../../utils/utils';\nimport { isIOS } from '@locallife/utils';\nimport { get414Px, rem } from '@locallife/design-base';\n\ninterface IProps {\n    goodsInfo: FeedGoodsInfo;\n    maxWidth: number;\n}\n\ninterface Layout {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n}\n\nexport const PriceView = React.memo(({ goodsInfo, maxWidth }: IProps) => {\n    // 是否是日历票品\n    const isTicket = useMemo(() => {\n        return goodsInfo?.itemTypeCode === ITEM_TYPE_CODE.TICKET;\n    }, [goodsInfo?.itemTypeCode]);\n    // 是否是次卡\n    const isSubCard = useMemo(() => {\n        return goodsInfo?.itemTypeCode === ITEM_TYPE_CODE.TIMECARD;\n    }, [goodsInfo?.itemTypeCode]);\n\n    const itemTimes =\n        goodsInfo?.productBizTagPositions?.good_goods_price_right_times_card;\n    // 共省30元\n    const itemPriceRightDiscount =\n        goodsInfo?.productBizTagPositions?.good_goods_price_right_discount;\n    // 快手更低价、会员专项、美团补贴\n    const itemPriceFormarketing =\n        goodsInfo?.productBizTagPositions\n            ?.good_goods_price_right_marketing_info;\n    const hasPriceLabel =\n        itemTimes?.length > 0 ||\n        itemPriceRightDiscount?.length > 0 ||\n        itemPriceFormarketing?.length > 0;\n\n    const hasOrginPrice = !!goodsInfo?.originPrice && !hasPriceLabel;\n\n    const [labelMaxWidth, setLabelMaxWidth] = useState(0);\n\n    const [showTags, setShowTags] = useState([] as BizTagsBean[]);\n\n    useEffect(() => {\n        // 单次\n        const itemTimes =\n            goodsInfo?.productBizTagPositions\n                ?.good_goods_price_right_times_card;\n        // 共省30元\n        const itemPriceRightDiscount =\n            goodsInfo?.productBizTagPositions?.good_goods_price_right_discount;\n        // 快手更低价、会员专项、美团补贴\n        const itemPriceFormarketing =\n            goodsInfo?.productBizTagPositions\n                ?.good_goods_price_right_marketing_info;\n\n        let recombineBizTags: BizTagsBean[] = [];\n        if ((itemTimes?.length ?? 0) > 0) {\n            recombineBizTags.push({\n                bizTags: itemTimes!!,\n            });\n        }\n        if ((itemPriceRightDiscount?.length ?? 0) > 0) {\n            recombineBizTags.push({\n                bizTags: itemPriceRightDiscount!!,\n            });\n        }\n        if ((itemPriceFormarketing?.length ?? 0) > 0) {\n            recombineBizTags.push({\n                bizTags: itemPriceFormarketing!!,\n            });\n        }\n        setShowTags(recombineBizTags);\n    }, [\n        goodsInfo?.productBizTagPositions?.good_goods_price_right_discount,\n        goodsInfo?.productBizTagPositions\n            ?.good_goods_price_right_marketing_info,\n        goodsInfo?.productBizTagPositions?.good_goods_price_right_times_card,\n    ]);\n\n    const _onLayout = useCallback(\n        (event) => {\n            const priceWidth = isIOS()\n                ? rem(event.nativeEvent.layout.width)\n                : get414Px(event.nativeEvent.layout.width);\n            const remainingWidth = maxWidth - priceWidth - 10;\n            setLabelMaxWidth(remainingWidth);\n        },\n        [maxWidth],\n    );\n\n    return (\n        <View style={styles.priceInfo}>\n            {/* 价格 */}\n            <View style={styles.priceLine} onLayout={_onLayout}>\n                <Text style={styles.unit}>{priceUnit}</Text>\n                <DotDecreasePrice\n                    price={goodsInfo?.discountPrice ?? ''}\n                    firstPriceStyle={styles.firstPrice}\n                    dotSecondPriceStyle={styles.secondPrice}\n                />\n                <Text style={styles.secondaryCardTimes}>\n                    {isSubCard\n                        ? `/${goodsInfo?.secondaryCardTimes}次`\n                        : isTicket\n                        ? '起'\n                        : ''}\n                </Text>\n                {/* 原价 */}\n                <ShowWithData data={hasOrginPrice}>\n                    <Text style={styles.originPrice}>\n                        {goodsInfo?.originPriceText}\n                    </Text>\n                </ShowWithData>\n            </View>\n            <ShowWithData data={labelMaxWidth > 0}>\n                <View style={styles.label}>\n                    <CommonLabelArray\n                        bizTagArray={showTags}\n                        maxWidth={labelMaxWidth}\n                        adaptScreen={true}\n                    />\n                </View>\n            </ShowWithData>\n        </View>\n    );\n});\n"],"mappings":"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","ignoreList":[]}