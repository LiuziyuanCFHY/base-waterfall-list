{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_padStart","_interopRequireDefault","_style","_utils","_bizComponent","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","getTime","timeStamp","initTimeStamp","endContent","leftTime","h","m","s","Math","floor","undefined","format","padStart","String","CountDown","end","countDown","useCallback","getServerTime","intervalIDRef","useRef","showTime","setShowTime","useState","countFinished","lftTime","callback","time","min","random","setTimeout","loopCountDown","resultTime","current","setInterval","then","result","clearInterval","useEffect","catch","Date","now","createElement","ShowWithData","data","View","style","styles","container","Text","title","_default","exports","React","memo"],"sources":["index.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { View, Text } from 'react-native';\nimport padStart from 'lodash/padStart';\nimport { styles } from './style';\nimport { getServerTime } from '@locallife/utils';\nimport { ShowWithData } from '@locallife/biz-component';\n\ntype Props = {\n    timeStamp: number;\n    end?: () => void;\n    endContent?: string;\n};\n\nfunction getTime(\n    timeStamp: number,\n    initTimeStamp: number,\n    endContent?: string,\n) {\n    const leftTime = timeStamp - initTimeStamp;\n    let h, m, s;\n    if (leftTime > 0) {\n        h = Math.floor(leftTime / 1000 / 60 / 60);\n        m = Math.floor((leftTime / 1000 / 60) % 60);\n        s = Math.floor((leftTime / 1000) % 60);\n    } else {\n        return endContent ? endContent : undefined;\n    }\n    const format = (n) => {\n        return padStart(String(n), 2, '0');\n    };\n    return `${format(h)}:${format(m)}:${format(s)}`;\n}\n\n// 商品item左侧封面倒计时组件\nfunction CountDown({ timeStamp, end, endContent }: Props) {\n    const countDown = useCallback(async () => {\n        return await getServerTime();\n    }, []);\n\n    const intervalIDRef = useRef<NodeJS.Timer>();\n    const [showTime, setShowTime] = useState('');\n\n    function countFinished(lftTime: number, callback?: () => void) {\n        if (callback) {\n            // lftTime 指到计时被舍入的部分，比如到计时剩余 100 ms，但因为小于 1s，会显示 0，lftTime = 100；\n            const time = Math.min(1000, lftTime + Math.random() * 1000);\n            setTimeout(() => {\n                callback();\n            }, time);\n        }\n    }\n\n    const loopCountDown = useCallback(\n        (timeStamp, resultTime, endContent) => {\n            //@ts-ignore\n            setShowTime(getTime(timeStamp, resultTime, endContent));\n            if (showTime !== endContent) {\n                intervalIDRef.current = setInterval(() => {\n                    countDown().then((result) => {\n                        //@ts-ignore\n                        setShowTime(getTime(timeStamp, result, endContent));\n                        if (showTime === endContent) {\n                            countFinished(timeStamp - result, end);\n                            //@ts-ignore\n                            clearInterval(intervalIDRef?.current);\n                        }\n                    });\n                }, 1000);\n            } else {\n                countFinished(timeStamp - resultTime, end);\n            }\n        },\n        [countDown, end, showTime],\n    );\n\n    useEffect(() => {\n        countDown()\n            .then((resultTime) => {\n                loopCountDown(timeStamp, resultTime, endContent);\n            })\n            .catch(() => {\n                loopCountDown(timeStamp, Date.now(), endContent);\n            });\n\n        return () => {\n            if (intervalIDRef?.current) {\n                //@ts-ignore\n                clearInterval(intervalIDRef?.current);\n            }\n        };\n    }, [countDown, endContent, loopCountDown, showTime, timeStamp]);\n    return (\n        <ShowWithData data={showTime}>\n            <View style={styles.container}>\n                <Text style={styles.title}>{showTime}</Text>\n            </View>\n        </ShowWithData>\n    );\n}\n\nexport default React.memo(CountDown);\n"],"mappings":"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","ignoreList":[]}