{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_WeeklyProduct","_interopRequireDefault","_styles","_krn","_utils","_baseImage","_logger","_utils2","_reactNativeLinearGradient","_config","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_extends","assign","bind","arguments","length","apply","_default","exports","memo","props","data","carouselList","feedItemIndex","onFeedWeeklyItemShow","onFeedWeeklyPress","showSetRef","useRef","Set","reportElementShow","useCallback","weeklyModel","bannerIndex","itemId","title","current","add","useEffect","onIndexChanged","item","paginationStyle","justifyContent","bottom","paddingRight","kidCarouselProps","borderRadius","carouselHeight","productAdapter","autoplay","loop","loadMinimal","autoplayTimeout","dotStyle","width","height","marginLeft","marginRight","activeDotStyle","WeeklyPromotionItem","index","productList","products","slice","onPress","jumpUrl","isEmptyString","itemClass","logLinkUrlNUll","minColor","backgroundColorMin","backgroundColorMax","maxColor","createElement","TouchableWithoutFeedback","style","styles","gradient","colors","LocalLifeImage","sceneType","containerItem","source","uri","backgroundImage","resizeMode","View","textContainer","titleContainer","Text","arrowImage","WEEKLY_ARROW_URL","subTitle","productContainer","map","onProductPress","key","container","KidCarousel"],"sources":["index.tsx"],"sourcesContent":["import React, { memo, useCallback, useEffect, useRef } from 'react';\nimport {\n    StyleProp,\n    Text,\n    TouchableWithoutFeedback,\n    View,\n    ViewStyle,\n} from 'react-native';\nimport WeeklyProduct from './WeeklyProduct';\nimport { WeeklyPromotionModel } from './Model/WeeklyPromotionModel';\nimport { styles } from './styles';\nimport { KidCarousel } from '@kid-ui/krn';\nimport { isEmptyString, jumpUrl } from '@locallife/utils';\nimport { LocalLifeImage } from '@locallife/base-image';\n// import { localLifeBizLogger } from '@locallife/log';\nimport { logLinkUrlNUll } from '../../../utils/logger';\nimport { productAdapter } from '../../../utils/utils';\nimport LinearGradient from 'react-native-linear-gradient';\nimport { WEEKLY_ARROW_URL } from '../config/config';\n\ninterface IProps {\n    data: Array<WeeklyPromotionModel>;\n    feedItemIndex: number;\n    onFeedWeeklyItemShow?: (\n        item: WeeklyPromotionModel,\n        index: number,\n        feedItemIndex: number,\n    ) => void;\n    onFeedWeeklyPress?: (\n        item: WeeklyPromotionModel,\n        index: number,\n        feedItemIndex: number,\n    ) => void;\n}\n\nexport default memo((props: IProps) => {\n    const {\n        data: carouselList,\n        feedItemIndex,\n        onFeedWeeklyItemShow,\n        onFeedWeeklyPress,\n    } = props;\n\n    const showSetRef = useRef(new Set());\n\n    const reportElementShow = useCallback(\n        (weeklyModel: WeeklyPromotionModel, bannerIndex) => {\n            const itemId = `${weeklyModel?.title}:${bannerIndex}`;\n            if (!showSetRef.current.has(itemId)) {\n                onFeedWeeklyItemShow &&\n                    onFeedWeeklyItemShow(\n                        weeklyModel,\n                        bannerIndex,\n                        feedItemIndex,\n                    );\n                // // 整体卡片曝光\n                // const logParams = {\n                //     url: weeklyModel?.jumpUrl,\n                //     campaign_name: weeklyModel?.title,\n                //     index: feedItemIndex + 1,\n                //     index_internal: bannerIndex + 1,\n                // };\n                // localLifeBizLogger.show('CAMPAIGN_CARD', logParams);\n                showSetRef.current.add(itemId);\n            }\n        },\n        [feedItemIndex, onFeedWeeklyItemShow],\n    );\n\n    // onIndexChanged在单个item时不会回调，这里补充调用下第0个\n    useEffect(() => {\n        reportElementShow(carouselList[0], 0);\n    }, [carouselList, reportElementShow]);\n\n    const onIndexChanged = useCallback(\n        (bannerIndex: number) => {\n            const item = carouselList?.[bannerIndex];\n            reportElementShow(item, bannerIndex);\n        },\n        [carouselList, reportElementShow],\n    );\n\n    const paginationStyle = {\n        justifyContent: 'center',\n        bottom: 5,\n        paddingRight: 5,\n    } as StyleProp<ViewStyle>;\n\n    const kidCarouselProps = {\n        borderRadius: 0,\n        carouselHeight: productAdapter(234),\n        autoplay: true,\n        loop: true,\n        onIndexChanged: onIndexChanged,\n        loadMinimal: false,\n        autoplayTimeout: 6,\n        dotStyle: {\n            width: productAdapter(2),\n            height: productAdapter(2),\n            marginLeft: productAdapter(2),\n            marginRight: 0,\n        },\n        activeDotStyle: {\n            width: 10,\n            height: productAdapter(2),\n            marginLeft: 4,\n            marginRight: 0,\n        },\n        paginationStyle,\n    };\n\n    const WeeklyPromotionItem = memo(\n        ({\n            weeklyModel,\n            index,\n        }: {\n            weeklyModel: WeeklyPromotionModel;\n            index: number;\n        }) => {\n            let productList = weeklyModel?.products ?? [];\n            if (productList.length > 2) {\n                productList = weeklyModel?.products.slice(0, 2);\n            }\n\n            // 没有商品的时候，上报\n            // if (productList.length === 0) {\n            //     let params = {\n            //         errMsg: '周周小促没有返回商品',\n            //         data: weeklyModel,\n            //     };\n            //     dataError(params);\n            // }\n\n            const onPress = useCallback(() => {\n                // localLifeBizLogger.click('CAMPAIGN_CARD', {\n                //     url: weeklyModel?.jumpUrl,\n                //     campaign_name: weeklyModel?.title,\n                //     index: feedItemIndex + 1,\n                //     index_internal: index + 1,\n                // });\n                onFeedWeeklyPress &&\n                    onFeedWeeklyPress(weeklyModel, index, feedItemIndex);\n                jumpUrl(weeklyModel?.jumpUrl, 'jumpToWeeklyPromotion');\n                // 检验快链是否为空，为空上报\n                if (isEmptyString(weeklyModel?.jumpUrl)) {\n                    const itemClass = typeof weeklyModel;\n                    logLinkUrlNUll('feedWeeklyCard', itemClass, weeklyModel);\n                }\n            }, [index, weeklyModel]);\n\n            // 渐变色值只下发一个的时候，展示纯色\n            let minColor =\n                weeklyModel?.backgroundColorMin ??\n                weeklyModel?.backgroundColorMax ??\n                '#FF3737';\n            let maxColor =\n                weeklyModel?.backgroundColorMax ??\n                weeklyModel?.backgroundColorMin ??\n                '#FF3737';\n\n            return (\n                <TouchableWithoutFeedback onPress={onPress}>\n                    <LinearGradient\n                        style={styles.gradient}\n                        colors={[minColor, maxColor]}\n                    >\n                        <LocalLifeImage\n                            sceneType={'WeeklyPromotion'}\n                            style={styles.containerItem}\n                            source={{ uri: weeklyModel.backgroundImage }}\n                            resizeMode={'cover'}\n                        >\n                            <View style={styles.textContainer}>\n                                <View style={styles.titleContainer}>\n                                    <Text style={styles.title}>\n                                        {weeklyModel?.title}\n                                    </Text>\n                                    <LocalLifeImage\n                                        sceneType={'WeeklyProductArrow'}\n                                        style={styles.arrowImage}\n                                        source={{ uri: WEEKLY_ARROW_URL }}\n                                        resizeMode={'cover'}\n                                    />\n                                </View>\n\n                                <Text style={styles.subTitle}>\n                                    {weeklyModel?.subTitle}\n                                </Text>\n                            </View>\n                            <View style={styles.productContainer}>\n                                {productList.map((item, index) => {\n                                    return (\n                                        <WeeklyProduct\n                                            data={item}\n                                            onProductPress={onPress}\n                                            key={index}\n                                        />\n                                    );\n                                })}\n                            </View>\n                        </LocalLifeImage>\n                    </LinearGradient>\n                </TouchableWithoutFeedback>\n            );\n        },\n    );\n\n    return (\n        // @ts-ignore\n        <View style={styles.container}>\n            <KidCarousel\n                {...kidCarouselProps}\n                key={'carouselKey' + (carouselList?.length ?? 0)}\n            >\n                {carouselList?.map(\n                    (item: WeeklyPromotionModel, index: number) => (\n                        <WeeklyPromotionItem\n                            weeklyModel={item}\n                            index={index}\n                            key={index}\n                        />\n                    ),\n                )}\n            </KidCarousel>\n        </View>\n    );\n});\n"],"mappings":"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","ignoreList":[]}