{"version":3,"names":["React","memo","useCallback","useMemo","useState","Text","TouchableOpacity","TouchableWithoutFeedback","View","styles","CommonLabels","ShowWithData","KwaiImage","isNotEmptyString","jumpUrl","useTextLineHook","CountDownContainer","NewUserBuyInfoView","PoiInfoView","DistanceLabel","PriceView","calculateSoldCount","ITEM_TYPE_CODE","FeedCommonGoodsCard","curItem","index","onItemClick","cardWidth","_productModel$product","productModel","data","countDownEnd","setCountDownEnd","handleProduction","goodsJumpUrl","handlePoi","item","iSClickPoi","poiJumpUrl","titleInfo","onTextLayout","productTitle","countDownEndCallback","isTicket","itemTypeCode","TICKET","isSubCard","TIMECARD","showCountDown","countdownInfo","hasDescLine","soldStock","feedBackRate","isNewUser","newUser","createElement","onPress","style","container","coverImage","source","uri","coverUrl","resizeMode","coverBottomContent","goodsInfo","end","content","firstLine","bizTags","productBizTagPositions","good_goods_title_core","adaptScreen","autoCut","containerStyle","labelStyle","brandName","brandText","numberOfLines","verLine","titleContainer","lineNumber","nextLine","descContainer","productInfo","maxWidth","poiName"],"sources":["index.tsx"],"sourcesContent":["/**\n * 通用商品卡\n * scene 团购优惠底部双列feed新商品卡\n * author liyi33\n */\nimport React, { memo, useCallback, useMemo, useState } from 'react';\nimport {\n    Text,\n    TouchableOpacity,\n    TouchableWithoutFeedback,\n    View,\n} from 'react-native';\nimport styles from './style';\nimport { CommonLabels, ShowWithData } from '@locallife/biz-component';\nimport KwaiImage from '@kds/image';\nimport { isNotEmptyString, jumpUrl } from '@locallife/utils';\nimport { FeedBaseModel, FeedGoodsInfo } from '../model';\nimport { useTextLineHook } from '../hook/hooks';\nimport CountDownContainer from './countDownContainer';\nimport { NewUserBuyInfoView } from './NewUserBuyInfoView';\nimport { PoiInfoView } from './PoiInfoView';\nimport { DistanceLabel } from './DistanceLabel';\nimport { PriceView } from './PriceView';\nimport { calculateSoldCount } from './NewUserBuyInfoView/hook';\nimport { ITEM_TYPE_CODE } from '../../../constants';\n\ninterface FeedRecommendCardProps {\n    curItem: FeedBaseModel;\n    index: number;\n    onItemClick?: (item: any, index: number) => void; // 用于外界埋点\n    cardWidth: number;\n}\n\nexport const FeedCommonGoodsCard = memo(\n    ({ curItem, index, onItemClick, cardWidth }: FeedRecommendCardProps) => {\n        const productModel: FeedGoodsInfo = curItem?.data ?? {};\n        // 倒计时是否结束\n        const [countDownEnd, setCountDownEnd] = useState(false);\n\n        const handleProduction = useCallback(() => {\n            if (onItemClick) {\n                onItemClick(curItem, index);\n            }\n            productModel?.goodsJumpUrl &&\n                jumpUrl(productModel?.goodsJumpUrl, 'TO_HALF_POI_PAGE');\n        }, [curItem, index, onItemClick, productModel?.goodsJumpUrl]);\n\n        const handlePoi = useCallback(() => {\n            if (onItemClick) {\n                const item = {\n                    ...curItem,\n                    iSClickPoi: true,\n                };\n                onItemClick(item, index);\n            }\n            productModel?.poiJumpUrl &&\n                jumpUrl(productModel?.poiJumpUrl, 'TO_POI');\n        }, [curItem, index, onItemClick, productModel?.poiJumpUrl]);\n\n        const { titleInfo, onTextLayout } = useTextLineHook(\n            productModel?.productTitle,\n        );\n\n        // 倒计时结束的回调\n        const countDownEndCallback = useCallback(() => {\n            setCountDownEnd(true);\n        }, []);\n\n        // 是否是日历票品\n        const isTicket = useMemo(() => {\n            return productModel?.itemTypeCode === ITEM_TYPE_CODE.TICKET;\n        }, [productModel?.itemTypeCode]);\n        // 是否是次卡\n        const isSubCard = useMemo(() => {\n            return productModel?.itemTypeCode === ITEM_TYPE_CODE.TIMECARD;\n        }, [productModel?.itemTypeCode]);\n        // 是否展示倒计时\n        const showCountDown = !countDownEnd && productModel?.countdownInfo;\n\n        // 是否展示第二行描述信息(这一行和倒计时互斥)\n        const hasDescLine =\n            (productModel?.soldStock ?? -1) > 0 &&\n            isNotEmptyString(productModel?.feedBackRate ?? '') &&\n            !productModel?.countdownInfo;\n\n        // 优先级： 日历票、次卡 > 新人> 正常样式\n        // 是否展示新人\n        const isNewUser = !isTicket && !isSubCard && productModel?.newUser;\n\n        return (\n            <TouchableWithoutFeedback onPress={handleProduction}>\n                <View style={styles.container}>\n                    <KwaiImage\n                        style={styles.coverImage}\n                        source={{\n                            uri: productModel?.coverUrl,\n                        }}\n                        resizeMode={'cover'}\n                    >\n                        {/* 头图下面展示的元素：倒计时、距离 */}\n                        <View style={styles.coverBottomContent}>\n                            {/* 距离  */}\n                            <DistanceLabel goodsInfo={productModel} />\n                            {/* 倒计时  */}\n                            <ShowWithData data={showCountDown}>\n                                <CountDownContainer\n                                    data={productModel}\n                                    end={countDownEndCallback}\n                                />\n                            </ShowWithData>\n                        </View>\n                    </KwaiImage>\n                    <View style={styles.content}>\n                        {/* 两行标题  */}\n                        <View style={styles.firstLine}>\n                            <CommonLabels\n                                bizTags={\n                                    productModel?.productBizTagPositions\n                                        ?.good_goods_title_core ?? []\n                                }\n                                adaptScreen={false}\n                                autoCut={false}\n                                containerStyle={styles.labelStyle}\n                            />\n                            <ShowWithData\n                                data={isNotEmptyString(\n                                    productModel?.brandName ?? '',\n                                )}\n                            >\n                                <Text\n                                    style={styles.brandText}\n                                    numberOfLines={1}\n                                >\n                                    {productModel?.brandName}\n                                </Text>\n                                <View style={styles.verLine} />\n                            </ShowWithData>\n                            <Text\n                                style={styles.titleContainer}\n                                // @ts-ignore\n                                onTextLayout={onTextLayout}\n                                numberOfLines={titleInfo.lineNumber}\n                            >\n                                {titleInfo.firstLine}\n                            </Text>\n                        </View>\n                        <ShowWithData\n                            data={isNotEmptyString(titleInfo.nextLine)}\n                        >\n                            <Text style={styles.nextLine} numberOfLines={1}>\n                                {titleInfo.nextLine}\n                            </Text>\n                        </ShowWithData>\n\n                        {/* 标题下的描述区 */}\n                        <ShowWithData data={hasDescLine}>\n                            <View style={styles.descContainer}>\n                                <Text\n                                    style={styles.feedBackRate}\n                                    numberOfLines={1}\n                                >\n                                    {productModel?.feedBackRate}\n                                </Text>\n                                <Text\n                                    style={styles.soldStock}\n                                    numberOfLines={1}\n                                >\n                                    {calculateSoldCount(\n                                        productModel?.soldStock,\n                                    )}\n                                </Text>\n                            </View>\n                        </ShowWithData>\n\n                        {/* 新人价格与抢购样式*/}\n                        <ShowWithData data={isNewUser}>\n                            <NewUserBuyInfoView productInfo={productModel} />\n                        </ShowWithData>\n\n                        {/* 价格区域，与新人互斥 */}\n                        <ShowWithData data={!isNewUser}>\n                            <PriceView\n                                goodsInfo={productModel}\n                                maxWidth={cardWidth}\n                            />\n                        </ShowWithData>\n                        {/* poi区域 */}\n                        <ShowWithData data={productModel?.poiName}>\n                            <TouchableOpacity onPress={handlePoi}>\n                                <PoiInfoView goodsInfo={productModel} />\n                            </TouchableOpacity>\n                        </ShowWithData>\n                    </View>\n                </View>\n            </TouchableWithoutFeedback>\n        );\n    },\n);\n"],"mappings":"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","ignoreList":[]}