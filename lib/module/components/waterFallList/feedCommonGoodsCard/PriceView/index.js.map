{"version":3,"names":["React","useCallback","useEffect","useMemo","useState","Text","View","CommonLabelArray","DotDecreasePrice","ShowWithData","ITEM_TYPE_CODE","styles","priceUnit","isIOS","get414Px","rem","PriceView","memo","goodsInfo","maxWidth","_goodsInfo$productBiz","_goodsInfo$productBiz2","_goodsInfo$productBiz3","_goodsInfo$productBiz7","_goodsInfo$productBiz8","_goodsInfo$productBiz9","isTicket","itemTypeCode","TICKET","isSubCard","TIMECARD","itemTimes","productBizTagPositions","good_goods_price_right_times_card","itemPriceRightDiscount","good_goods_price_right_discount","itemPriceFormarketing","good_goods_price_right_marketing_info","hasPriceLabel","length","hasOrginPrice","originPrice","labelMaxWidth","setLabelMaxWidth","showTags","setShowTags","_goodsInfo$productBiz4","_goodsInfo$productBiz5","_goodsInfo$productBiz6","recombineBizTags","push","bizTags","_onLayout","event","priceWidth","nativeEvent","layout","width","remainingWidth","createElement","style","priceInfo","priceLine","onLayout","unit","price","discountPrice","firstPriceStyle","firstPrice","dotSecondPriceStyle","secondPrice","secondaryCardTimes","data","originPriceText","label","bizTagArray","adaptScreen"],"sources":["index.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { Text, View } from 'react-native';\nimport {\n    BizTagsBean,\n    CommonLabelArray,\n    DotDecreasePrice,\n    ShowWithData,\n} from '@locallife/biz-component';\nimport { FeedGoodsInfo } from '../../model';\nimport { ITEM_TYPE_CODE } from '../../../../constants';\nimport styles from './styles';\nimport { priceUnit } from '../../../../utils/utils';\nimport { isIOS } from '@locallife/utils';\nimport { get414Px, rem } from '@locallife/design-base';\n\ninterface IProps {\n    goodsInfo: FeedGoodsInfo;\n    maxWidth: number;\n}\n\ninterface Layout {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n}\n\nexport const PriceView = React.memo(({ goodsInfo, maxWidth }: IProps) => {\n    // 是否是日历票品\n    const isTicket = useMemo(() => {\n        return goodsInfo?.itemTypeCode === ITEM_TYPE_CODE.TICKET;\n    }, [goodsInfo?.itemTypeCode]);\n    // 是否是次卡\n    const isSubCard = useMemo(() => {\n        return goodsInfo?.itemTypeCode === ITEM_TYPE_CODE.TIMECARD;\n    }, [goodsInfo?.itemTypeCode]);\n\n    const itemTimes =\n        goodsInfo?.productBizTagPositions?.good_goods_price_right_times_card;\n    // 共省30元\n    const itemPriceRightDiscount =\n        goodsInfo?.productBizTagPositions?.good_goods_price_right_discount;\n    // 快手更低价、会员专项、美团补贴\n    const itemPriceFormarketing =\n        goodsInfo?.productBizTagPositions\n            ?.good_goods_price_right_marketing_info;\n    const hasPriceLabel =\n        itemTimes?.length > 0 ||\n        itemPriceRightDiscount?.length > 0 ||\n        itemPriceFormarketing?.length > 0;\n\n    const hasOrginPrice = !!goodsInfo?.originPrice && !hasPriceLabel;\n\n    const [labelMaxWidth, setLabelMaxWidth] = useState(0);\n\n    const [showTags, setShowTags] = useState([] as BizTagsBean[]);\n\n    useEffect(() => {\n        // 单次\n        const itemTimes =\n            goodsInfo?.productBizTagPositions\n                ?.good_goods_price_right_times_card;\n        // 共省30元\n        const itemPriceRightDiscount =\n            goodsInfo?.productBizTagPositions?.good_goods_price_right_discount;\n        // 快手更低价、会员专项、美团补贴\n        const itemPriceFormarketing =\n            goodsInfo?.productBizTagPositions\n                ?.good_goods_price_right_marketing_info;\n\n        let recombineBizTags: BizTagsBean[] = [];\n        if ((itemTimes?.length ?? 0) > 0) {\n            recombineBizTags.push({\n                bizTags: itemTimes!!,\n            });\n        }\n        if ((itemPriceRightDiscount?.length ?? 0) > 0) {\n            recombineBizTags.push({\n                bizTags: itemPriceRightDiscount!!,\n            });\n        }\n        if ((itemPriceFormarketing?.length ?? 0) > 0) {\n            recombineBizTags.push({\n                bizTags: itemPriceFormarketing!!,\n            });\n        }\n        setShowTags(recombineBizTags);\n    }, [\n        goodsInfo?.productBizTagPositions?.good_goods_price_right_discount,\n        goodsInfo?.productBizTagPositions\n            ?.good_goods_price_right_marketing_info,\n        goodsInfo?.productBizTagPositions?.good_goods_price_right_times_card,\n    ]);\n\n    const _onLayout = useCallback(\n        (event) => {\n            const priceWidth = isIOS()\n                ? rem(event.nativeEvent.layout.width)\n                : get414Px(event.nativeEvent.layout.width);\n            const remainingWidth = maxWidth - priceWidth - 10;\n            setLabelMaxWidth(remainingWidth);\n        },\n        [maxWidth],\n    );\n\n    return (\n        <View style={styles.priceInfo}>\n            {/* 价格 */}\n            <View style={styles.priceLine} onLayout={_onLayout}>\n                <Text style={styles.unit}>{priceUnit}</Text>\n                <DotDecreasePrice\n                    price={goodsInfo?.discountPrice ?? ''}\n                    firstPriceStyle={styles.firstPrice}\n                    dotSecondPriceStyle={styles.secondPrice}\n                />\n                <Text style={styles.secondaryCardTimes}>\n                    {isSubCard\n                        ? `/${goodsInfo?.secondaryCardTimes}次`\n                        : isTicket\n                        ? '起'\n                        : ''}\n                </Text>\n                {/* 原价 */}\n                <ShowWithData data={hasOrginPrice}>\n                    <Text style={styles.originPrice}>\n                        {goodsInfo?.originPriceText}\n                    </Text>\n                </ShowWithData>\n            </View>\n            <ShowWithData data={labelMaxWidth > 0}>\n                <View style={styles.label}>\n                    <CommonLabelArray\n                        bizTagArray={showTags}\n                        maxWidth={labelMaxWidth}\n                        adaptScreen={true}\n                    />\n                </View>\n            </ShowWithData>\n        </View>\n    );\n});\n"],"mappings":"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","ignoreList":[]}