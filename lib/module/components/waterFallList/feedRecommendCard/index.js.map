{"version":3,"names":["React","memo","useCallback","useMemo","Image","Platform","Text","TouchableOpacity","View","styles","CommonLabels","ITEM_TYPE_CODE","priceUnit","getProductIcon","KwaiImage","jumpUrl","localLifeBizLogger","FeedRecommendItem","curItem","index","_curItem$productBizTa2","_curItem$productBizTa3","_curItem$productBizTa4","clickLogParam","key","exp","click","poi_id","poiId","item_id","itemId","item_index","item_name","productTitle","handleProduction","goodsHalfJumpUrl","handleDistanceClick","poiHalfJumpUrl","productIcon","_curItem$productBizTa","productBizTagPositions","payment_succeed_item_title_core","isTicket","itemTypeCode","TICKET","isSubCard","TIMECARD","isShowOriginPrice","Number","originPrice","discountPrice","createElement","style","recommendItem","activeOpacity","onPress","head","source","uri","coverUrl","resizeMode","content","flex","numberOfLines","url","icon","width","height","OS","txt","titleInfo","priceInfo","unit","secondaryCardTimes","payment_succeed_item_price_right","bizTags","containerStyle","priceMark","autoCut","originPriceInfo","poi","poiInfo","poiIcon","poiTxt","poiName","distanceText"],"sources":["index.tsx"],"sourcesContent":["/**\n * 通用商品卡\n * scene 底部推荐双列feed商品卡\n * author yiyushu\n */\n\nimport React, { memo, useCallback, useMemo } from 'react';\nimport { Image, Platform, Text, TouchableOpacity, View } from 'react-native';\nimport styles from './style';\nimport { CommonLabels } from '@locallife/biz-component';\nimport { ITEM_TYPE_CODE } from '../../../constants';\nimport { priceUnit } from '../../../utils/utils';\nimport { getProductIcon } from '../../../utils/getProductIcon';\nimport KwaiImage from '@kds/image';\nimport { jumpUrl } from '@locallife/utils';\nimport { localLifeBizLogger } from '@locallife/log';\nimport { FeedGoodsInfo } from '../model';\n\ninterface FeedRecommendCardProps {\n    curItem: FeedGoodsInfo;\n    index: number;\n}\n\nexport const FeedRecommendItem = memo(\n    ({ curItem, index }: FeedRecommendCardProps) => {\n        /**\n         * 点击上报\n         * @param key 埋点key\n         * @param exp 拓展埋点数据，必须是个对象！\n         */\n        const clickLogParam = useCallback(\n            (key, exp = {}) => {\n                localLifeBizLogger.click(key, {\n                    poi_id: curItem?.poiId || '',\n                    item_id: curItem?.itemId || '',\n                    item_index: index + 1,\n                    item_name: curItem?.productTitle || '',\n                    ...exp,\n                });\n            },\n            [curItem?.itemId, curItem?.poiId, curItem?.productTitle, index],\n        );\n        const handleProduction = useCallback(() => {\n            clickLogParam('LOCALLIFE_COMPOSITE_GOODS_CARD');\n            curItem?.goodsHalfJumpUrl &&\n                jumpUrl(curItem?.goodsHalfJumpUrl, 'TO_HALF_POI_PAGE');\n        }, [clickLogParam, curItem?.goodsHalfJumpUrl]);\n\n        // 点击距离跳转POI\n        const handleDistanceClick = useCallback(() => {\n            clickLogParam('LOCALLIFE_COMPOSITE_GOODS_CARD_POI_BUTTON');\n            curItem?.poiHalfJumpUrl &&\n                jumpUrl(curItem?.poiHalfJumpUrl, 'TO_POI');\n        }, [clickLogParam, curItem?.poiHalfJumpUrl]);\n\n        const productIcon = useMemo(() => {\n            return getProductIcon(\n                curItem?.productBizTagPositions\n                    ?.payment_succeed_item_title_core,\n            );\n        }, [curItem?.productBizTagPositions?.payment_succeed_item_title_core]);\n\n        // 是否是日历票品\n        const isTicket = useMemo(() => {\n            return curItem?.itemTypeCode === ITEM_TYPE_CODE.TICKET;\n        }, [curItem?.itemTypeCode]);\n        // 是否是次卡\n        const isSubCard = useMemo(() => {\n            return curItem?.itemTypeCode === ITEM_TYPE_CODE.TIMECARD;\n        }, [curItem?.itemTypeCode]);\n\n        // 折扣价(discountPrice)为兜底的市场价(originPrice)时、当为次卡时 均不显示市场价（originPrice）、当为日历票时也不展示\n        const isShowOriginPrice = useMemo(() => {\n            return (\n                Number(curItem?.originPrice) > Number(curItem?.discountPrice) &&\n                !isSubCard &&\n                !isTicket\n            );\n        }, [curItem?.originPrice, curItem?.discountPrice, isSubCard, isTicket]);\n\n        return (\n            <View style={styles.recommendItem}>\n                <TouchableOpacity activeOpacity={1} onPress={handleProduction}>\n                    <KwaiImage\n                        style={styles.head}\n                        source={{\n                            uri: curItem.coverUrl,\n                        }}\n                        resizeMode={'cover'}\n                    />\n                    <View style={styles.content}>\n                        {/* 瀑布流需要动态计算高度，来区分放左边还是右边，改样式时需要关注styles和countFeedItemHeight相关逻辑  */}\n                        <Text style={[styles.flex]} numberOfLines={2}>\n                            {!!productIcon?.url && (\n                                <KwaiImage\n                                    resizeMode={'cover'}\n                                    style={[\n                                        styles.icon,\n                                        {\n                                            width: productIcon?.width,\n                                            height: productIcon?.height,\n                                        },\n                                    ]}\n                                    source={{\n                                        uri: productIcon?.url,\n                                    }}\n                                />\n                            )}\n                            {/* android图片设置marginRight不生效，故使用空格 */}\n                            {!!productIcon?.url &&\n                                Platform.OS === 'android' && (\n                                    <Text style={styles.txt}>&nbsp;</Text>\n                                )}\n                            <Text style={styles.titleInfo}>\n                                {curItem?.productTitle}\n                            </Text>\n                        </Text>\n                        <View style={[styles.flex, styles.priceInfo]}>\n                            <Text style={styles.discountPrice}>\n                                <Text style={styles.unit}>{priceUnit}</Text>\n                                {curItem.discountPrice}\n                                <Text style={styles.secondaryCardTimes}>\n                                    {isSubCard\n                                        ? `/${curItem.secondaryCardTimes}次`\n                                        : isTicket\n                                        ? '起'\n                                        : ''}\n                                </Text>\n                            </Text>\n                            {!!curItem?.productBizTagPositions\n                                ?.payment_succeed_item_price_right && (\n                                <CommonLabels\n                                    bizTags={\n                                        curItem?.productBizTagPositions\n                                            ?.payment_succeed_item_price_right\n                                    }\n                                    containerStyle={styles.priceMark}\n                                    autoCut={false}\n                                />\n                            )}\n\n                            {isShowOriginPrice ? (\n                                <View style={styles.originPriceInfo}>\n                                    <Text style={styles.originPrice}>\n                                        {priceUnit}\n                                        {curItem.originPrice}\n                                    </Text>\n                                </View>\n                            ) : null}\n                        </View>\n                    </View>\n                </TouchableOpacity>\n                <TouchableOpacity\n                    style={[styles.poi, styles.flex]}\n                    onPress={handleDistanceClick}\n                >\n                    <View style={[styles.flex, styles.poiInfo]}>\n                        <Image\n                            style={styles.poiIcon}\n                            source={{\n                                uri: 'https://s2-10833.kwimgs.com/kos/nlav10833/ll-transaction/static/transaction/img/poi-icon.962351164b4b18e8.png',\n                            }}\n                        />\n                        <Text\n                            style={[styles.poiTxt, styles.poiName]}\n                            numberOfLines={1}\n                        >\n                            {curItem.poiName}\n                        </Text>\n                    </View>\n                    {!!curItem.distanceText && (\n                        <Text style={[styles.poiTxt]}>\n                            {curItem.distanceText}\n                        </Text>\n                    )}\n                </TouchableOpacity>\n            </View>\n        );\n    },\n);\n"],"mappings":"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","ignoreList":[]}