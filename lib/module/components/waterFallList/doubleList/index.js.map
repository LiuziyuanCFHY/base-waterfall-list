{"version":3,"names":["React","memo","useCallback","useMemo","useRef","View","DEFAULT_PADDING","GOOD_CARD_WIDTH","leftKey","rightKey","CommonList","FeedRecommendItem","isAndroid","styles","FEED_CARD_TYPE","FeedCommonGoodsCard","FeedWeeklyPromotionCard","useDoubleListData","keyExtractor","item","index","DoubleList","props","uiMode","recoList","onItemShow","onItemHide","onItemClick","data","initialNumToRender","paddingHorizontal","cardWidth","refreshCount","ListFooterComponent","onEndReached","onFeedWeeklyItemShow","onFeedWeeklyPress","listKeys","left","right","onEndReachedThreshold","loadingStatus","leftData","lFeeds","rightData","rFeeds","updateHeight","onLayout","listKey","event","_event$nativeEvent","nativeEvent","layout","height","renderFeedItem","feedItemIndex","type","COMMON_GOOD_CARD","createElement","curItem","WEEKLY_CARD","realIndex","windowSize","undefined","renderSeparator","style","distance","isFetching","handleEndReached","current","endReached","renderList","feeds","renderItem","ItemSeparatorComponent","width","containerRow","justifyContent"],"sources":["index.tsx"],"sourcesContent":["import React, { memo, useCallback, useMemo, useRef } from 'react';\nimport { View } from 'react-native';\nimport {\n    DEFAULT_PADDING,\n    GOOD_CARD_WIDTH,\n    leftKey,\n    rightKey,\n} from '../config/config';\nimport { CommonList } from '@locallife/biz-component';\nimport { FeedRecommendItem } from '../feedRecommendCard';\nimport { isAndroid } from '@locallife/utils';\nimport { styles } from './style';\nimport { FEED_CARD_TYPE } from '../../../constants';\nimport { FeedCommonGoodsCard } from '../feedCommonGoodsCard';\nimport FeedWeeklyPromotionCard from '../FeedWeeklyPromotionCard';\nimport { useDoubleListData } from '../hook/hooks';\nimport { FeedModel } from '../model';\nimport { WeeklyPromotionModel } from '../FeedWeeklyPromotionCard/Model/WeeklyPromotionModel';\n\ninterface IProps {\n    uiMode?: 'space-evenly' | 'space-between';\n    recoList: Array<FeedModel>;\n    itemVisiblePercentThreshold?: number;\n    onItemShow?: (item: FeedModel, index: number) => void;\n    onItemHide?: (item: FeedModel, index: number) => void;\n    onItemClick?: (item: any, index: number) => void;\n    updateHeight?: (listKey: any, height: number) => void;\n    data?: Array<FeedModel>;\n    index: number;\n    initialNumToRender?: number;\n    paddingHorizontal?: number;\n    cardWidth?: number;\n    refreshCount?: number;\n    listKeys?: {\n        left: string;\n        right: string;\n    };\n    ListFooterComponent?: () => React.ReactElement | null;\n    onFeedWeeklyItemShow?: (\n        item: WeeklyPromotionModel,\n        feedItemIndex: number,\n        index: number,\n    ) => void;\n    onFeedWeeklyPress?: (\n        item: WeeklyPromotionModel,\n        feedItemIndex: number,\n        index: number,\n    ) => void;\n    onEndReached?: () => void;\n    onEndReachedThreshold?: number;\n    loadingStatus?: boolean;\n}\n\n// 卡片索引\nconst keyExtractor = (item: FeedModel, index: number) => {\n    return index + '_doubleList';\n};\n\nexport const DoubleList = memo((props: IProps) => {\n    const {\n        uiMode = 'space-between',\n        recoList,\n        onItemShow,\n        onItemHide,\n        onItemClick,\n        data,\n        initialNumToRender,\n        paddingHorizontal = DEFAULT_PADDING, // 左右间距，默认11\n        cardWidth = GOOD_CARD_WIDTH, // 卡片宽度，默认192\n        refreshCount,\n        ListFooterComponent,\n        onEndReached,\n        onFeedWeeklyItemShow,\n        onFeedWeeklyPress,\n        listKeys = {\n            left: leftKey,\n            right: rightKey,\n        },\n        onEndReachedThreshold,\n        loadingStatus,\n    } = props;\n\n    const {\n        leftData: lFeeds,\n        rightData: rFeeds,\n        updateHeight,\n    } = useDoubleListData(recoList, refreshCount, cardWidth);\n\n    const onLayout = useCallback(\n        (listKey, event) => {\n            updateHeight?.(listKey, event?.nativeEvent?.layout?.height);\n        },\n        [updateHeight],\n    );\n\n    // 单个卡片\n    const renderFeedItem = useCallback(\n        ({ item, index: feedItemIndex }) => {\n            if (item?.type === FEED_CARD_TYPE.COMMON_GOOD_CARD) {\n                return (\n                    <FeedCommonGoodsCard\n                        curItem={item}\n                        index={feedItemIndex}\n                        onItemClick={onItemClick}\n                        cardWidth={cardWidth}\n                    />\n                );\n            } else if (item?.type === FEED_CARD_TYPE.WEEKLY_CARD) {\n                return (\n                    <FeedWeeklyPromotionCard\n                        data={item?.data}\n                        feedItemIndex={item.realIndex}\n                        onFeedWeeklyItemShow={onFeedWeeklyItemShow}\n                        onFeedWeeklyPress={onFeedWeeklyPress}\n                    />\n                );\n            } else {\n                return (\n                    <FeedRecommendItem curItem={item} index={feedItemIndex} />\n                );\n            }\n        },\n        [cardWidth, onItemClick, onFeedWeeklyItemShow, onFeedWeeklyPress],\n    );\n\n    const windowSize = useMemo(() => {\n        return isAndroid() ? 3 : undefined;\n    }, []);\n\n    const renderSeparator = useCallback(() => {\n        return <View style={styles.distance} />;\n    }, []);\n\n    const isFetching = useRef(false);\n\n    const handleEndReached = useCallback(async () => {\n        if (isFetching.current || loadingStatus) {\n            return;\n        }\n        isFetching.current = true;\n        await onEndReached?.();\n        isFetching.current = false;\n    }, [onEndReached, loadingStatus]);\n\n    const endReached = useCallback(() => {\n        handleEndReached();\n    }, [handleEndReached]);\n\n    const renderList = useCallback(\n        (listKey: string, feeds: FeedModel[]) => {\n            return (\n                <View>\n                    <CommonList\n                        //eslint-disable-next-line react/jsx-no-bind\n                        onLayout={(event) => {\n                            onLayout(listKey, event);\n                        }}\n                        keyExtractor={keyExtractor}\n                        renderItem={renderFeedItem}\n                        data={feeds}\n                        listKey={listKey}\n                        onItemShow={onItemShow}\n                        onItemHide={onItemHide}\n                        windowSize={windowSize} // 解决安卓滑动突然转向，卡顿问题\n                        ItemSeparatorComponent={renderSeparator}\n                        initialNumToRender={initialNumToRender}\n                        style={{ width: cardWidth }}\n                        onEndReached={endReached}\n                        onEndReachedThreshold={onEndReachedThreshold ?? 0.1}\n                    />\n                </View>\n            );\n        },\n        [\n            cardWidth,\n            initialNumToRender,\n            onItemHide,\n            onItemShow,\n            onLayout,\n            renderFeedItem,\n            renderSeparator,\n            windowSize,\n            endReached,\n            onEndReachedThreshold,\n        ],\n    );\n\n    // 瀑布流卡片\n    if (lFeeds && rFeeds) {\n        return (\n            <View>\n                <View\n                    style={[\n                        styles.containerRow,\n                        {\n                            justifyContent: uiMode,\n                            paddingHorizontal: paddingHorizontal,\n                        },\n                    ]}\n                >\n                    {renderList(listKeys.left, lFeeds)}\n                    {renderList(listKeys.right, rFeeds)}\n                </View>\n                {!!ListFooterComponent && ListFooterComponent?.()}\n            </View>\n        );\n    }\n    return renderList('one', data ?? []);\n});\n"],"mappings":"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","ignoreList":[]}