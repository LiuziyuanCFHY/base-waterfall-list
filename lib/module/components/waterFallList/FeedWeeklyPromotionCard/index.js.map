{"version":3,"names":["React","memo","useCallback","useEffect","useRef","Text","TouchableWithoutFeedback","View","WeeklyProduct","styles","KidCarousel","isEmptyString","jumpUrl","LocalLifeImage","logLinkUrlNUll","productAdapter","LinearGradient","WEEKLY_ARROW_URL","props","data","carouselList","feedItemIndex","onFeedWeeklyItemShow","onFeedWeeklyPress","showSetRef","Set","reportElementShow","weeklyModel","bannerIndex","itemId","title","current","has","add","onIndexChanged","item","paginationStyle","justifyContent","bottom","paddingRight","kidCarouselProps","borderRadius","carouselHeight","autoplay","loop","loadMinimal","autoplayTimeout","dotStyle","width","height","marginLeft","marginRight","activeDotStyle","WeeklyPromotionItem","index","productList","products","length","slice","onPress","itemClass","minColor","backgroundColorMin","backgroundColorMax","maxColor","createElement","style","gradient","colors","sceneType","containerItem","source","uri","backgroundImage","resizeMode","textContainer","titleContainer","arrowImage","subTitle","productContainer","map","onProductPress","key","container","_extends"],"sources":["index.tsx"],"sourcesContent":["import React, { memo, useCallback, useEffect, useRef } from 'react';\nimport {\n    StyleProp,\n    Text,\n    TouchableWithoutFeedback,\n    View,\n    ViewStyle,\n} from 'react-native';\nimport WeeklyProduct from './WeeklyProduct';\nimport { WeeklyPromotionModel } from './Model/WeeklyPromotionModel';\nimport { styles } from './styles';\nimport { KidCarousel } from '@kid-ui/krn';\nimport { isEmptyString, jumpUrl } from '@locallife/utils';\nimport { LocalLifeImage } from '@locallife/base-image';\n// import { localLifeBizLogger } from '@locallife/log';\nimport { logLinkUrlNUll } from '../../../utils/logger';\nimport { productAdapter } from '../../../utils/utils';\nimport LinearGradient from 'react-native-linear-gradient';\nimport { WEEKLY_ARROW_URL } from '../config/config';\n\ninterface IProps {\n    data: Array<WeeklyPromotionModel>;\n    feedItemIndex: number;\n    onFeedWeeklyItemShow?: (\n        item: WeeklyPromotionModel,\n        index: number,\n        feedItemIndex: number,\n    ) => void;\n    onFeedWeeklyPress?: (\n        item: WeeklyPromotionModel,\n        index: number,\n        feedItemIndex: number,\n    ) => void;\n}\n\nexport default memo((props: IProps) => {\n    const {\n        data: carouselList,\n        feedItemIndex,\n        onFeedWeeklyItemShow,\n        onFeedWeeklyPress,\n    } = props;\n\n    const showSetRef = useRef(new Set());\n\n    const reportElementShow = useCallback(\n        (weeklyModel: WeeklyPromotionModel, bannerIndex) => {\n            const itemId = `${weeklyModel?.title}:${bannerIndex}`;\n            if (!showSetRef.current.has(itemId)) {\n                onFeedWeeklyItemShow &&\n                    onFeedWeeklyItemShow(\n                        weeklyModel,\n                        bannerIndex,\n                        feedItemIndex,\n                    );\n                // // 整体卡片曝光\n                // const logParams = {\n                //     url: weeklyModel?.jumpUrl,\n                //     campaign_name: weeklyModel?.title,\n                //     index: feedItemIndex + 1,\n                //     index_internal: bannerIndex + 1,\n                // };\n                // localLifeBizLogger.show('CAMPAIGN_CARD', logParams);\n                showSetRef.current.add(itemId);\n            }\n        },\n        [feedItemIndex, onFeedWeeklyItemShow],\n    );\n\n    // onIndexChanged在单个item时不会回调，这里补充调用下第0个\n    useEffect(() => {\n        reportElementShow(carouselList[0], 0);\n    }, [carouselList, reportElementShow]);\n\n    const onIndexChanged = useCallback(\n        (bannerIndex: number) => {\n            const item = carouselList?.[bannerIndex];\n            reportElementShow(item, bannerIndex);\n        },\n        [carouselList, reportElementShow],\n    );\n\n    const paginationStyle = {\n        justifyContent: 'center',\n        bottom: 5,\n        paddingRight: 5,\n    } as StyleProp<ViewStyle>;\n\n    const kidCarouselProps = {\n        borderRadius: 0,\n        carouselHeight: productAdapter(234),\n        autoplay: true,\n        loop: true,\n        onIndexChanged: onIndexChanged,\n        loadMinimal: false,\n        autoplayTimeout: 6,\n        dotStyle: {\n            width: productAdapter(2),\n            height: productAdapter(2),\n            marginLeft: productAdapter(2),\n            marginRight: 0,\n        },\n        activeDotStyle: {\n            width: 10,\n            height: productAdapter(2),\n            marginLeft: 4,\n            marginRight: 0,\n        },\n        paginationStyle,\n    };\n\n    const WeeklyPromotionItem = memo(\n        ({\n            weeklyModel,\n            index,\n        }: {\n            weeklyModel: WeeklyPromotionModel;\n            index: number;\n        }) => {\n            let productList = weeklyModel?.products ?? [];\n            if (productList.length > 2) {\n                productList = weeklyModel?.products.slice(0, 2);\n            }\n\n            // 没有商品的时候，上报\n            // if (productList.length === 0) {\n            //     let params = {\n            //         errMsg: '周周小促没有返回商品',\n            //         data: weeklyModel,\n            //     };\n            //     dataError(params);\n            // }\n\n            const onPress = useCallback(() => {\n                // localLifeBizLogger.click('CAMPAIGN_CARD', {\n                //     url: weeklyModel?.jumpUrl,\n                //     campaign_name: weeklyModel?.title,\n                //     index: feedItemIndex + 1,\n                //     index_internal: index + 1,\n                // });\n                onFeedWeeklyPress &&\n                    onFeedWeeklyPress(weeklyModel, index, feedItemIndex);\n                jumpUrl(weeklyModel?.jumpUrl, 'jumpToWeeklyPromotion');\n                // 检验快链是否为空，为空上报\n                if (isEmptyString(weeklyModel?.jumpUrl)) {\n                    const itemClass = typeof weeklyModel;\n                    logLinkUrlNUll('feedWeeklyCard', itemClass, weeklyModel);\n                }\n            }, [index, weeklyModel]);\n\n            // 渐变色值只下发一个的时候，展示纯色\n            let minColor =\n                weeklyModel?.backgroundColorMin ??\n                weeklyModel?.backgroundColorMax ??\n                '#FF3737';\n            let maxColor =\n                weeklyModel?.backgroundColorMax ??\n                weeklyModel?.backgroundColorMin ??\n                '#FF3737';\n\n            return (\n                <TouchableWithoutFeedback onPress={onPress}>\n                    <LinearGradient\n                        style={styles.gradient}\n                        colors={[minColor, maxColor]}\n                    >\n                        <LocalLifeImage\n                            sceneType={'WeeklyPromotion'}\n                            style={styles.containerItem}\n                            source={{ uri: weeklyModel.backgroundImage }}\n                            resizeMode={'cover'}\n                        >\n                            <View style={styles.textContainer}>\n                                <View style={styles.titleContainer}>\n                                    <Text style={styles.title}>\n                                        {weeklyModel?.title}\n                                    </Text>\n                                    <LocalLifeImage\n                                        sceneType={'WeeklyProductArrow'}\n                                        style={styles.arrowImage}\n                                        source={{ uri: WEEKLY_ARROW_URL }}\n                                        resizeMode={'cover'}\n                                    />\n                                </View>\n\n                                <Text style={styles.subTitle}>\n                                    {weeklyModel?.subTitle}\n                                </Text>\n                            </View>\n                            <View style={styles.productContainer}>\n                                {productList.map((item, index) => {\n                                    return (\n                                        <WeeklyProduct\n                                            data={item}\n                                            onProductPress={onPress}\n                                            key={index}\n                                        />\n                                    );\n                                })}\n                            </View>\n                        </LocalLifeImage>\n                    </LinearGradient>\n                </TouchableWithoutFeedback>\n            );\n        },\n    );\n\n    return (\n        // @ts-ignore\n        <View style={styles.container}>\n            <KidCarousel\n                {...kidCarouselProps}\n                key={'carouselKey' + (carouselList?.length ?? 0)}\n            >\n                {carouselList?.map(\n                    (item: WeeklyPromotionModel, index: number) => (\n                        <WeeklyPromotionItem\n                            weeklyModel={item}\n                            index={index}\n                            key={index}\n                        />\n                    ),\n                )}\n            </KidCarousel>\n        </View>\n    );\n});\n"],"mappings":"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","ignoreList":[]}