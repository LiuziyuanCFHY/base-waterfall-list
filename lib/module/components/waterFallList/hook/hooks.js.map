{"version":3,"names":["useCallback","useEffect","useRef","useState","countFeedItemHeight","GOOD_CARD_WIDTH","leftKey","ONE_LINE_TITLE_FONT","rightKey","useLatest","EStyleUtil","useDoubleListData","feedGoodsInfos","refreshCount","cardWidth","leftHeight","rightHeight","dataList","setDataList","leftData","setLeft","rightData","setRight","lastIndex","lastRefreshCount","length","itemId","lData","rData","tmpFeedGoodsInfos","current","slice","forEach","item","index","newItem","realIndex","itemHeight","push","prevLeftData","concat","prevRightData","updateHeight","listKey","height","useTextLineHook","title","lastTitle","haveLayout","titleInfo","setTitleInfo","realTitle","lineNumber","firstLine","nextLine","maxHeight","transNumberToRem","onTextLayout","e","nativeEvent","lines","text","remainText","i"],"sources":["hooks.ts"],"sourcesContent":["/**\n * @file hooks.ts\n * @description 请在此添加属于该页面的自定义hooks\n */\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { countFeedItemHeight } from '../../../utils/utils';\nimport {\n    GOOD_CARD_WIDTH,\n    leftKey,\n    ONE_LINE_TITLE_FONT,\n    rightKey,\n} from '../config/config';\nimport { useLatest } from '@locallife/base-hooks';\nimport { FeedModel } from '../model';\nimport { EStyleUtil } from '../../../utils/EStyleUtil';\n\nexport const useDoubleListData = (\n    feedGoodsInfos: FeedModel[],\n    refreshCount: number = 0,\n    cardWidth: number = GOOD_CARD_WIDTH,\n) => {\n    const leftHeight = useRef(0);\n    const rightHeight = useRef(0);\n    const [dataList, setDataList] = useState([]);\n    const [leftData, setLeft] = useState<FeedModel[]>([]);\n    const [rightData, setRight] = useState<FeedModel[]>([]);\n    const lastIndex = useRef(0);\n    const lastRefreshCount = useRef(0);\n\n    useEffect(() => {\n        if (feedGoodsInfos.length > 0) {\n            setDataList([{ itemId: 'have-data' }]);\n        }\n    }, [feedGoodsInfos.length]);\n\n    useEffect(() => {\n        const lData = [];\n        const rData = [];\n        let tmpFeedGoodsInfos = feedGoodsInfos;\n        if (\n            lastIndex.current >= feedGoodsInfos.length &&\n            refreshCount === lastRefreshCount.current\n        ) {\n            // 没有新增卡片直接返回\n            return;\n        }\n        if (lastIndex.current !== 0) {\n            tmpFeedGoodsInfos = tmpFeedGoodsInfos.slice(lastIndex.current);\n        }\n        lastIndex.current = feedGoodsInfos.length;\n        tmpFeedGoodsInfos.forEach((item, index) => {\n            const newItem = { ...item };\n            // 1、realIndex赋值\n            newItem.realIndex = index;\n            // 2、计算卡片高度\n            const itemHeight = countFeedItemHeight(\n                newItem,\n                ONE_LINE_TITLE_FONT,\n                cardWidth,\n            );\n            // 3、构造双列的数据源\n            if (leftHeight.current <= rightHeight.current) {\n                leftHeight.current += itemHeight;\n                lData.push(newItem);\n            } else {\n                rightHeight.current += itemHeight;\n                rData.push(newItem);\n            }\n        });\n        if (refreshCount === lastRefreshCount.current) {\n            setLeft((prevLeftData) => prevLeftData.concat(lData));\n            setRight((prevRightData) => prevRightData.concat(rData));\n        } else {\n            // 重新刷新了，更新数据源\n            setLeft(lData);\n            setRight(rData);\n            lastRefreshCount.current = refreshCount;\n        }\n        // 仅feedGoodsInfos依赖即可\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [feedGoodsInfos]);\n\n    const updateHeight = useCallback((listKey: string, height: number) => {\n        if (listKey === leftKey) {\n            leftHeight.current = height;\n        } else if (listKey === rightKey) {\n            rightHeight.current = height;\n        }\n    }, []);\n\n    return {\n        dataList,\n        leftData,\n        rightData,\n        updateHeight,\n    };\n};\n\nexport const useTextLineHook = (title: string) => {\n    const lastTitle = useLatest(title);\n    const haveLayout = useRef(false);\n\n    const [titleInfo, setTitleInfo] = useState<{\n        lineNumber: number;\n        firstLine: string;\n        nextLine: string;\n        maxHeight?: number;\n        realTitle: string;\n    }>({\n        realTitle: title,\n        lineNumber: 2,\n        firstLine: lastTitle.current || '',\n        nextLine: '',\n        maxHeight: EStyleUtil.transNumberToRem(36),\n    });\n\n    useEffect(() => {\n        if (lastTitle.current !== titleInfo.realTitle) {\n            setTitleInfo({\n                realTitle: lastTitle.current,\n                lineNumber: 2,\n                firstLine: lastTitle.current || '',\n                nextLine: '',\n                maxHeight: EStyleUtil.transNumberToRem(36),\n            });\n            haveLayout.current = false;\n        }\n    }, [lastTitle, title, titleInfo.realTitle]);\n\n    const onTextLayout = useCallback(\n        (e) => {\n            if (haveLayout.current) {\n                return;\n            }\n            if (e.nativeEvent.lines.length > 1) {\n                const { text } = e.nativeEvent.lines[0];\n                let remainText = '';\n                for (let i = 1; i < e.nativeEvent.lines.length; i++) {\n                    remainText += e.nativeEvent.lines[i].text;\n                }\n                setTitleInfo({\n                    realTitle: lastTitle.current,\n                    lineNumber: 1,\n                    firstLine: text,\n                    nextLine: remainText,\n                    maxHeight: e.nativeEvent.lines[0].height * 2,\n                });\n            } else {\n                setTitleInfo({\n                    realTitle: lastTitle.current,\n                    lineNumber: 1,\n                    firstLine: lastTitle.current,\n                    nextLine: '',\n                    maxHeight: EStyleUtil.transNumberToRem(36),\n                });\n            }\n            haveLayout.current = true;\n        },\n        [lastTitle],\n    );\n    return {\n        onTextLayout,\n        titleInfo,\n    };\n};\n"],"mappings":"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","ignoreList":[]}